-- Znalezc wszystkich zawodnikow, dla ktorych zawodnicy lepsi od nich maja sume bramek wieksza o 5


 
 SELECT a.id_zawodnika                                                                  -- DLA KA¯DEGO ZAWODNIKA
 FROM mecze_zawodnicy as a, mecze_zawodnicy as b, mecze_zawodnicy as c                  --                     |
 GROUP BY a.id_zawodnika                                                                --                    \|/ 
 HAVING sum(a.bramki) + 5 = (                                                           --                     |        SPRAWDZAM, CZY JEST O 5 WIÊKSZA NI¯ LICZBA BRAMEK 'SPRAWDZANEGO' ZAWODNIKA <-|
                            SELECT sum(b.bramki)                                        --                    \|/       LICZÊ SUMÊ BRAMEK (DLA WSZYSTKICH TYCH ZAWODNIKÓW) --------------------------|
                            FROM b                                                      --                     |                                /|\
                            WHERE b.id_zawodnika = any(                                 --                    \|/                                |
                                                      SELECT c.id_zawodnika             -- SZUKAM ZAWODNIKÓW, KTÓRZY STRZELILI WIÊCEJ BRAMEK------                    
                                                      FROM c
                                                      GROUP BY c.id_zawodnika
                                                      HAVING sum(c.bramki) > sum(a.bramki)
                                                      )
                            )
       

-- pytanie: czy subquery mo¿e byæ argumentem funkcji agreguj¹cej (SUM(), AVG() itp. ) zak³adaj¹c, ¿e zwraca ono jedn¹ kolumnê o odpowiednim typie (w tym przypadku numerycznym)?
-- w tym konkretnym przypadku chodzi o to, czy powy¿sz¹ SQL-kê mo¿na zast¹piæ czym takim:

SELECT a.id_zawodnika
FROM mecze_zawodnicy as a, mecze_zawodnicy as b
GROUP BY a.id_zawodnika
HAVING sum(a.bramki) + 5 = (
                           SELECT sum (
                                      SELECT sum(b.bramki)
                                      FROM b
                                      GROUP by b.id_zawodnika
                                      HAVING sum(b.bramki) > sum(a.bramki)
                                      )
                           FROM mecze_zawodnicy                              -- czy ten FROM tutaj w ogóle ma sens?? mo¿na go wyjebaæ i zostawiæ samo polecenie SELECT sum() ?? 
                           )
       
       
--------------------------------------------------------------------------------------------------------------------------       

-- Dla kazdego zawodnika znalezc sume bramek zawodnikow bardziej bramkostrzelnych od niego



-- zak³adam,¿e subquery mo¿e byæ argumentem funkcji sum()

SELECT a.id_zawodnika, sum(
                          SELECT sum(b.bramki)
                          FROM b
                          GROUP BY b.id_zawodnika
                          HAVING sum(b.bramki) > sum(a.bramki)
                          )
FROM mecze_zawodnicy as a, mecze_zawodnicy as b 
GROUP BY a.id_zawodnika
            

-- je¿eli jednak nie mo¿e byæ, to mo¿e w ten sposób trzeba to zrobiæ?

SELECT a.id_zawodnika, sum(c.wynik)
FROM mecze_zawodnicy as a, mecze_zawodnicy as b, (
                                                 SELECT sum(b.bramki) as wynik
                                                 FROM b
                                                 GROUP BY b.id_zawodnika
                                                 HAVING sum(b.bramki) > sum(a.bramki)
                                                 ) as c
GROUP by a.id_zawodnika


--------------------------------------------------------------------------------------------------------------------------       

-- Jeszcze tak pierwotnie to próbowalimy zrobiæ chyba takie zadanie: wylistowaæ tych zawodników, którzy maj¹ liczbê bramek wiêksz¹ od redniej

SELECT id_zawodnika
FROM mecze_zawodnicy
GROUP BY id_zawodnika
HAVING sum(bramki) > (
                     SELECT avg(wynik)
                     FROM (
                          SELECT sum(bramki) as wynik
                          FROM mecze_zawodnicy
                          GROUP BY id.zawodnika
                          )
                     )
                     
-- pytanie: czy zapisuj¹c to w ten sposób jak powy¿ej mogê nie nadawaæ ¿adnych aliasów na tabele?
 

   


